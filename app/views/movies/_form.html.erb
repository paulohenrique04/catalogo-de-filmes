<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
      <div class="card shadow-sm rounded-4 p-4">
        <h2 class="text-center mb-4"><%= movie.new_record? ? "Novo Filme" : "Editar Filme" %></h2>

        <%= form_with(model: movie, local: true, id: 'movie-form') do |form| %>
          <% if movie.errors.any? %>
            <div class="alert alert-danger">
              <h5><%= pluralize(movie.errors.count, "erro") %> impediram que este filme fosse salvo:</h5>
              <ul class="mb-0">
                <% movie.errors.full_messages.each do |msg| %>
                  <li><%= msg %></li>
                <% end %>
              </ul>
            </div>
          <% end %>

          <!-- Campo de título com botão de busca IA -->
          <div class="mb-3">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <%= form.label :title, "Título", class: "form-label mb-0" %>
              <button type="button" id="fetch-ai-data" class="btn btn-outline-primary btn-sm">
                <i class="bi bi-robot"></i> Buscar dados com IA
              </button>
            </div>
            <%= form.text_field :title, class: "form-control", placeholder: "Digite o título do filme", id: "movie-title" %>
            <small class="text-muted">Digite o título e clique em "Buscar dados com IA" para preencher automaticamente</small>
          </div>

          <div id="ai-loading" class="alert alert-info d-none">
            <div class="d-flex align-items-center">
              <div class="spinner-border spinner-border-sm me-2" role="status">
                <span class="visually-hidden">Carregando...</span>
              </div>
              Buscando informações do filme...
            </div>
          </div>

          <div id="ai-error" class="alert alert-danger d-none"></div>

          <div class="mb-3">
            <%= form.label :synopsis, "Sinopse", class: "form-label" %>
            <%= form.text_area :synopsis, class: "form-control", placeholder: "Escreva a sinopse", rows: 4, id: "movie-synopsis" %>
          </div>

          <div class="mb-3">
            <%= form.label :release_year, "Ano de Lançamento", class: "form-label" %>
            <%= form.number_field :release_year, class: "form-control", placeholder: "Ex: 2025", id: "movie-release-year" %>
          </div>

          <div class="mb-3">
            <%= form.label :duration, "Duração (minutos)", class: "form-label" %>
            <%= form.number_field :duration, class: "form-control", placeholder: "Duração em minutos", id: "movie-duration" %>
          </div>

          <div class="mb-3">
            <%= form.label :director, "Diretor", class: "form-label" %>
            <%= form.text_field :director, class: "form-control", placeholder: "Nome do diretor", id: "movie-director" %>
          </div>

          <div class="field mb-3">
            <%= form.label :image, "Poster" %>
            <%= form.file_field :image %>
          </div>

          <div class="mb-4">
            <%= form.label :category_ids, "Categorias", class: "form-label fw-semibold" %>
            
            <div class="alert alert-light border py-2">
              <small class="text-muted">
                <i class="bi bi-mouse"></i> Segure <kbd>Ctrl</kbd> (Windows/Linux) ou <kbd>Cmd</kbd> (Mac) para selecionar múltiplas categorias
              </small>
            </div>
            
            <%= form.collection_select :category_ids, 
                Category.all.order(:name), 
                :id, 
                :name, 
                { include_blank: "Selecione as categorias..." }, 
                { 
                  multiple: true, 
                  class: "form-select",
                  size: 6
                } %>
          </div>

          <%= render 'tags/form_tags' %>


          <div class="d-grid">
            <%= form.submit movie.new_record? ? "Criar Filme" : "Atualizar Filme", class: "btn btn-primary btn-lg" %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>

<%= content_for :head do %>
  <%= javascript_include_tag 'movies_form', 'data-turbo-track': 'reload' %>
<% end %>